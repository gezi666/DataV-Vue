(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0c8445"],{"53c4":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div")},i=[],r=(a("99af"),a("4160"),a("c975"),a("b0c0"),a("b64b"),a("acd8"),a("ac1f"),a("1276"),a("159b"),a("ade3")),n=(a("96cf"),a("1da1")),o=a("b897"),l=a("e11e"),c=a("0e0b"),f={name:"lineVector",mixins:[o["a"]],data:function(){return{lStyles:null,refType:"",clickStyle:{},hoverStyle:{},data:[],gisData:[],layerObj:null,defaultParams:null,showLayer:!0}},created:function(){this.showLayer=this.styleConf.defaultShowLayer,this.processStyle(this.styleConf.refType)},methods:{styleConfChanged:function(){this.refType!==this.styleConf.refType&&(this.lStyles=null,this.refType=this.styleConf.refType),this.processStyle(this.styleConf.refType),this.notifyBase()},convertChartData:function(e){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function a(){var s,i,r,n,o,l,c,f;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if("dataset"!==t.compConf.data.datasource.type){a.next=5;break}for(s=t._convertDatasetToGeoJson(e),i=0;i<s.length;i++){for(r=!1,n=0;n<t.data.length;n++)t.data[n].name===s[i].name&&(t.data[n]=s[i],r=!0);r||t.data.push(s[i])}a.next=21;break;case 5:if("gisServer"!==t.compConf.data.datasource.type){a.next=11;break}return a.next=8,t.loadGisServer("Line");case 8:t.data=a.sent,a.next=21;break;case 11:if("gisSet"!==t.compConf.data.datasource.type){a.next=20;break}if(o=_.cloneDeep(t.compConf.data.conf.sevLayer),!(o&&o.layerObj&&o.layerObj.length>0)){a.next=17;break}return a.next=16,t.loadGisServer("Line");case 16:t.gisData=a.sent;case 17:t.dataConf.datasetSelectedIds.length>0&&t.dataConf[t.dataConf.datasetSelectedIds[0]]&&(l=t.dataConf[t.dataConf.datasetSelectedIds[0]].properties,c=t.dataConf[t.dataConf.datasetSelectedIds[0]].refGisField,f=t.dataConf[t.dataConf.datasetSelectedIds[0]].refSetField,l&&l.length>0&&c&&f&&(-1===l.indexOf(f)&&t.$message({type:"error",message:"数据集中不包含关联字段，请重新选择"}),t.data=t.relDataToSet(e,l,c,f))),a.next=21;break;case 20:t.data=e;case 21:t.notifyBase(),t.bindEvent();case 23:case"end":return a.stop()}}),a)})))()},processStyle:function(e){this.clickStyle=this.styleConf.clickStyle,this.hoverStyle=this.styleConf.hoverStyle;var t={unique:{index:0,style:[]},clazz:{},range:{}};switch(e){case"unique":t.unique.style=this._styleParser(this.styleConf.refInfo.lineStyles,e);break;case"clazz":t.clazz=this._styleParser(this.styleConf.refInfo["class"],e);break;case"range":t.range=this._styleParser(this.styleConf.refInfo.seg,e);break}this.lStyles=t},buildLineVector:function(e){var t=this,a=this.styleConf.refType,s=this.styleConf.ref;this.styleConf.dynamicRef&&(s=this.convertExpression(this.styleConf.ref),-1!==s.indexOf("${")&&this.defaultParams&&(s=this.convertExpression(this.defaultParams)));var i=this.styleConf.name,r=this,n=e.feats,o=l["geoJSON"]({type:"FeatureCollection",features:n},{onEachFeature:function(e,t){t.properties=e.properties}});o.id=c["a"].guid(),o.name=i&&""!==i?i:"line_"+c["a"].guid();var f=[];o.eachLayer((function(e){var i=r._calcStyle(a,s,e.properties);if(i){e.setStyle(i);var n=r.generateTipContent(e.properties);n&&""!==n&&e.bindTooltip(n,{sticky:!0,direction:"auto",className:"dark-tip"}),e.on("click",(function(e){t.featClick(r,e)})),e.on("mouseover",(function(e){t.featHover(r,e)})),e.on("mouseout",(function(e){t.featStatusClean(r,e)})),e._group=o}else f.push(e)}));for(var h=0;h<f.length;h++)o.removeLayer(f[h]);return 0===o._layers.length?null:o},_calcStyle:function(e,t,a){if(!t||""===t||!a.hasOwnProperty(t))return null;var s=a[t];if("unique"===e){var i=this.styleConf.refInfo.filters.split(",");if(""===s||-1===i.indexOf(s)){var r=this.lStyles.unique;if(r.style.length>0){if(r.index<r.style.length){var n=r.style[r.index];return r.index=r.index+1,n}return r.index=0,r.style[r.index]}}}else if("clazz"===e){var o=this.lStyles.clazz;if(Object.keys(o).length>0)for(var l in o)if(s===l)return o[l]}else if("range"===e){var c=this.lStyles.range;if(s=parseFloat(s),Object.keys(c).length>0){var f=null;for(var h in c){if(f)break;var y=parseFloat(h.split("-")[0]),d=parseFloat(h.split("-")[1]);f=y<=d?s>=y&&s<d?c[h]:null:s>=d&&s<y?c[h]:null}return f}}return null},_styleParser:function(e,t){var a;return a="unique"===t?[]:{},e.forEach((function(e){var s={opacity:e.opacity,weight:e.weight,color:e.color};e.dashArray&&(s.dashArray=e.dashArray),e.dashOffset&&(s.dashOffset=e.dashOffset),s.bkStyle=s,"unique"===t?a.push(s):"clazz"===t?(s.clz=e.clz,a[s.clz]=s):"range"===t?(s.f=e.f,s.t=e.t,a["".concat(s.f,"-").concat(s.t)]=s):a[t]=s})),a},generateTipContent:function(e){if(0===this.styleConf.tooltip.items.length)return null;for(var t=this.styleConf.tooltip.items,a='<div style="padding: 10px;width: auto">',s={},i=0;i<t.length;i++){var r=t[i];s[r.ref]=r.refAlias}var n=this.styleConf.ref;for(var o in this.styleConf.dynamicRef&&(n=this.convertExpression(this.styleConf.ref)),e){var l=void 0;if(o===n&&(l=this.styleConf.ref),s.hasOwnProperty(o)||s.hasOwnProperty(l)){var c=s[o]&&""!==s[o]?s[o]:o;s.hasOwnProperty(l)&&(c=s[l]),a+='<div style="display: flex">\n                               <div style="max-width:140px;text-align: right">'.concat(c.toUpperCase(),'：</div>\n                               <div style="text-align: left">').concat(e[o],"</div>\n                               </div>")}}return a+="</div>",a},featClick:function(e,t){if(this.clickStyle&&this.clickStyle.enable){var a=null;if(t.target._group.eachLayer((function(e){e.setStyle(e.options.bkStyle),e.selected&&(a=e)})),t.target.selected)return void(t.target.selected=!1);a&&a._leaflet_id!==t.target._leaflet_id&&(a.selected=!1);var s=this._styleParser([this.clickStyle],"click"),i=t.target.options,r=i.weight,n=i.color,o=i.opacity,l=i.dashArray,c=i.dashOffset;s.click.bkClickStyle={weight:r,color:n,opacity:o,dashArray:l,dashOffset:c},s.click.bkStyle={weight:t.target.options.bkStyle.weight,color:t.target.options.bkStyle.color,opacity:t.target.options.bkStyle.opacity,dashArray:t.target.options.bkStyle.dashArray,dashOffset:t.target.options.bkStyle.dashOffset},t.target.setStyle(s.click),t.target.selected=!0}},featHover:function(e,t){if(this.hoverStyle&&this.hoverStyle.enable){if(t.target._group.eachLayer((function(e){e.selected||(e.setStyle(e.options.bkStyle),e.closeTooltip())})),t.target.selected)return;var a=this._styleParser([this.hoverStyle],"hover"),s=t.target.options,i=s.weight,r=s.color,n=s.opacity,o=s.dashArray,l=s.dashOffset;a.hover.bkHoverStyle={weight:i,color:r,opacity:n,dashArray:o,dashOffset:l},a.hover.bkStyle={weight:t.target.options.bkStyle.weight,color:t.target.options.bkStyle.color,opacity:t.target.options.bkStyle.opacity,dashArray:t.target.options.bkStyle.dashArray,dashOffset:t.target.options.bkStyle.dashOffset},this.styleConf.tooltip&&this.styleConf.tooltip.enable&&t.target.openTooltip(),t.target.setStyle(a.hover)}},featStatusClean:function(e,t){t.target._group.eachLayer((function(e){e.selected||(e.setStyle(e.options.bkStyle),e.closeTooltip())}))},_updateDataMeta:function(e){this.$store.getters.getPreviewState?this.$store.commit("modifyValueByGIS",{attrs:[this.compConf.compId,"data","conf","datasetMeta"],value:e}):this.$store.commit("modifyValueByCompId",{attrs:[this.compConf.compId,"data","conf","datasetMeta"],value:e})},notifyBase:function(){if(this.gisBase){if(this.data&&this.data.length>0){var e=this.data[0];"gisServer"===this.compConf.data.datasource.type&&this._updateDataMeta(e.datasetMeta),this.layerObj=this.buildLineVector(e)}else this.layerObj=null;this.layerObj?this.$emit("updateVecLayer",{id:this.compConf.compId,show:this.showLayer,type:"line",layerObj:this.layerObj}):this.$emit("clearVecLayer",{id:this.compConf.compId,show:this.showLayer})}},getStyleObj:function(){if(!this.styleConf.legend||!this.layerObj)return null;var e=this.lStyles[this.styleConf.refType],t=[];if(e.hasOwnProperty("style")&&e.hasOwnProperty("index"))for(var a=0;a<e.style.length;a++)t.push({name:"",style:e.style[a]});else for(var s in e)t.push({name:s,style:e[s]});return{id:this.layerObj.id,name:this.compConf.name,type:"Line",list:t}},linkageConfChanged:function(){this.$store.getters.getPreviewState||this.bindEvent()},bindEvent:function(){if(this.compConf.linkage&&this.compConf.linkage.linkRevEvents)for(var e=this.compConf.linkage.linkRevEvents,t=0;t<e.length;t++){var a=e[t],s=a.evtName.split(":")[1];"click"===s&&this._clickByLinkAge(a)}},toggleShow:function(e,t){if(!this.layerObj&&this.gisBase&&this.data&&this.data.length>0){var a=this.data[0];this.layerObj=this.buildPointVector(a)}this.layerObj&&(e&&t?this.$emit("updateVecLayer",{id:this.compConf.compId,type:"line",layerObj:this.layerObj,show:!0,toggle:!0}):e&&!t?this.$emit("clearVecLayer",{id:this.compConf.compId,show:!1,toggle:!0}):this.notifyBase())},_clickByLinkAge:function(e){var t=this;this.$evtBus.on(e,(function(e){t.styleConf.dynamicRef&&t.updateRefKey(e)}))},updateRefKey:function(e){var t=[];e.refData.forEach((function(a){var s=a.cond,i=a.to.split("$")[1],r=e.data[a.from.split("$")[1]];t.push({operationType:s,bindMapperColumn:i,value:r})}));var a={target:e.target,source:e.source,name:e.name,data:t,sourceData:e.data},s={};s[this.compConf.compId]=Object(r["a"])({},"".concat(e.name),a),this.$store.commit("setLinkage",s);var i=e.switchVisible&&e.switchVisible[this.compConf.compId]&&e.switchVisible.hasOwnProperty(this.compConf.compId);e.ctrlShow&&(this.showLayer=i),this.toggleShow(e.ctrlShow,i)}}},h=f,y=a("2877"),d=Object(y["a"])(h,s,i,!1,null,"3c2cb328",null);t["default"]=d.exports}}]);