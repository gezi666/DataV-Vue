(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-27039334"],{"0730":function(e,t,a){},"215b":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.datasetOptions.length>0?a("el-form",{attrs:{size:"small","label-width":"120"}},[e.dataCfg.selectDataSet?a("el-form-item",{attrs:{label:e.dataCfg.selectDataSet.name}},[a("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"","multiple-limit":e.multiDataset?0:1},on:{change:e._onDatasetChanged},model:{value:e.datasetSelectedIds,callback:function(t){e.datasetSelectedIds=t},expression:"datasetSelectedIds"}},e._l(e.datasetOptions,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1):e._e(),e._l(e.datasetSelectedIds,(function(t){return a("gis-set-binding",{key:t,attrs:{"dataset-selected-id":t,title:e.getSelectDataSetName(t),metaDataList:e._getMetaDataList(t)}})})),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e._loadCompData}},[e._v("加载数据")]),a("el-button",{on:{click:function(t){e.dialogVisible=!0}}},[e._v("查看数据")])],1),e.dialogVisible?a("show-data-dialog",{attrs:{visible:e.dialogVisible},on:{back:e._onDiaologClosed}}):e._e()],2):e._e()},l=[],n=(a("b0c0"),a("5530")),s=a("ecdd"),o=a("2f62"),r=a("5b12"),c=a("40e9"),d=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-card",{staticClass:"dataset-setting-box"},[a("div",{attrs:{slot:"header"},slot:"header"},[a("span",[e._v("数据集（"+e._s(e.title)+"）配置")])]),a("el-form-item",{attrs:{label:"选择服务"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",size:"mini"},on:{change:e.serviceSelected},model:{value:e.layerEdit.selectedSev,callback:function(t){e.$set(e.layerEdit,"selectedSev",t)},expression:"layerEdit.selectedSev"}},e._l(e.services,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1),e.layerEdit.serverObj?a("el-form-item",{attrs:{label:"选择图层"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"","multiple-limit":e.layerEdit.serverObj.enableDrill?0:1,clearable:"",size:"mini"},on:{change:e.layerSelected},model:{value:e.layerEdit.selectedLayer,callback:function(t){e.$set(e.layerEdit,"selectedLayer",t)},expression:"layerEdit.selectedLayer"}},e._l(e.layerEdit.serverObj.selected,(function(e){return a("el-option",{key:e.name,attrs:{value:e.name,label:e.alias||e.name}})})),1)],1):e._e(),e.layerEdit.serverObj?a("el-form-item",{attrs:{label:"默认参数"}},[a("el-input",{staticStyle:{width:"100%"},attrs:{size:"mini"},model:{value:e.layerEdit.defaultParams,callback:function(t){e.$set(e.layerEdit,"defaultParams",t)},expression:"layerEdit.defaultParams"}})],1):e._e(),a("el-collapse",{directives:[{name:"show",rawName:"v-show",value:e.datasetSelectedId,expression:"datasetSelectedId"}],attrs:{accordion:""}},[a("el-collapse-item",{attrs:{title:e.title}},[e.layerEdit.layerObj&&e.layerEdit.layerObj.length>0?a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.datasetSelectedId,expression:"datasetSelectedId"}],attrs:{label:"关联GIS字段"}},[a("el-select",{staticStyle:{width:"100%"},on:{change:e.changeRefGisField},model:{value:e.refGisField,callback:function(t){e.refGisField=t},expression:"refGisField"}},e._l(e.gisRefFields,(function(t){return a("el-option",{key:t.columnName,attrs:{label:t.columnDesc,value:t.columnName,disabled:t.disabled}},[a("span",{staticStyle:{float:"left"}},[e._v(e._s(t.columnName)+"("+e._s(t.columnDesc)+")")]),a("span",{staticStyle:{float:"right","margin-right":"30px",color:"#8492a6","font-size":"13px"}},[e._v(e._s(1==t.columnDefDire?"指标":"维度"))])])})),1)],1):e._e(),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.datasetSelectedId,expression:"datasetSelectedId"}],attrs:{label:"关联数据集字段"}},[a("el-select",{staticStyle:{width:"100%"},on:{change:e.changeRefSetField},model:{value:e.refSetField,callback:function(t){e.refSetField=t},expression:"refSetField"}},e._l(e.metaList,(function(t){return a("el-option",{key:t.columnName,attrs:{label:t.columnDesc,value:t.columnName,disabled:t.disabled}},[a("span",{staticStyle:{float:"left"}},[e._v(e._s(t.columnName)+"("+e._s(t.columnDesc)+")")]),a("span",{staticStyle:{float:"right","margin-right":"30px",color:"#8492a6","font-size":"13px"}},[e._v(e._s(1==t.columnDefDire?"指标":"维度"))])])})),1)],1),e.dataCfg.propsBinding?a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.datasetSelectedId,expression:"datasetSelectedId"}],attrs:{label:e.dataCfg.propsBinding.name}},[a("el-select",{staticStyle:{width:"100%"},attrs:{multiple:""},on:{change:e.changePropertiesValue},model:{value:e.properties,callback:function(t){e.properties=t},expression:"properties"}},e._l(e.metaList,(function(t){return a("el-option",{key:t.columnName,attrs:{label:t.columnDesc,value:t.columnName,disabled:t.disabled}},[a("span",{staticStyle:{float:"left"}},[e._v(e._s(t.columnName)+"("+e._s(t.columnDesc)+")")]),a("span",{staticStyle:{float:"right","margin-right":"30px",color:"#8492a6","font-size":"13px"}},[e._v(e._s(1==t.columnDefDire?"指标":"维度"))])])})),1)],1):e._e()],1),a("el-collapse-item",{attrs:{title:"必要参数"}},[a("el-checkbox-group",{on:{change:e._requireFieldsChanged},model:{value:e.requireFields,callback:function(t){e.requireFields=t},expression:"requireFields"}},e._l(e.metaList,(function(e){return a("el-checkbox",{key:e.id,attrs:{label:e.columnName}})})),1)],1),a("el-collapse-item",{attrs:{title:"条件配置"}},[a("div",{staticClass:"global-params-box"},[a("el-button",{staticStyle:{"margin-bottom":"2px"},attrs:{type:"primary",icon:"el-icon-edit",size:"mini"},on:{click:function(t){return t.stopPropagation(),e._addElementConfig(t)}}},[e._v("条件配置 ")]),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.searchElementConfigs,border:""}},[a("el-table-column",{attrs:{prop:"columnName",label:"条件字段"}}),a("el-table-column",{attrs:{prop:"paramsFrom",label:"取值方式"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(1===t.row.paramsFrom?"自定义":"全局参数")+" ")]}}])}),a("el-table-column",{attrs:{prop:"value",label:"值/全局参数"}}),a("el-table-column",{attrs:{prop:"operationType",label:"条件",width:"80"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e._getOperationType(t.row.operationType))+" ")]}}])})],1)],1)]),a("el-collapse-item",{attrs:{title:"排序配置"}},[a("div",{staticClass:"global-sort-params"},[a("el-button",{staticStyle:{"margin-bottom":"2px"},attrs:{type:"primary",icon:"el-icon-edit",size:"mini"},on:{click:function(t){return t.stopPropagation(),function(){e.$refs.orderByConfig.show()}()}}},[e._v("排序配置 ")]),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.orderByConfigDTO,border:""}},[a("el-table-column",{attrs:{prop:"bindMapperColumn",label:"排序字段"}}),a("el-table-column",{attrs:{prop:"orderByType",label:"排序方式"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s("asc"===t.row.orderByType?"正序":"倒序")+" ")]}}])})],1)],1)]),a("el-collapse-item",{attrs:{title:"数据集结果配置"}},[a("el-form-item",{attrs:{label:"结果集数据条数限制"}},[a("el-input",{on:{change:e._onResultNumberChange},model:{value:e.resultNumber,callback:function(t){e.resultNumber=t},expression:"resultNumber"}})],1)],1)],1),e.elementConfigsEditDialogVisible?a("search-element-config",{attrs:{visible:e.elementConfigsEditDialogVisible,metaList:e.metaList,globalParams:e.searchElementConfigs},on:{onBack:e._elementConfigsEditClosed,onSave:e._updateElementConfigs}}):e._e(),a("order-by-config",{ref:"orderByConfig",attrs:{metaList:e.metaList,globalParams:e.orderByConfigDTO},on:{onSave:e._updateOrderByConfigs}})],1)},u=[],p=(a("a4d3"),a("e01a"),a("c975"),a("0d03"),a("d3b7"),a("25f0"),a("2ef0")),m=a.n(p),f=a("9cda"),h=a("2885"),b=a("357f"),y=(a("bc3a"),a("785d")),g={name:"gisSet",props:["datasetSelectedId","title","metaDataList"],computed:Object(n["a"])(Object(n["a"])(Object(n["a"])({},Object(o["c"])({activeComp:"getFirstActiveComp",getCompConf:"getCompConf"})),Object(o["d"])(["window"])),{},{dataCfg:function(){return Object(c["a"])(this.activeComp.componentName)},globalParamOptions:function(){return this.window.globalParams},compConfig:function(){return"baseMap"===this.activeComp.compDef?"base":"themeLayer"===this.activeComp.compType?"child":"not"},gisRefFields:function(){if(0===this.layerEdit.layerObj.length)return[];if(-1!==this.layerEdit.layerObj[0].selectedFields.indexOf("*"))return this.layerEdit.layerObj[0].fields;for(var e=[],t=0;t<this.layerEdit.layerObj[0].selectedFields.length;t++)for(var a=0;a<this.layerEdit.layerObj[0].fields.length;a++){var i=this.layerEdit.layerObj[0].selectedFields[t],l=this.layerEdit.layerObj[0].fields[a].name;i===l&&e.push(this.layerEdit.layerObj[0].fields[a])}return e}}),components:{searchElementConfig:h["a"],orderByConfig:b["a"]},watch:{datasetSelectedId:{handler:function(e,t){e&&this._getDatasetMetadata()}},"activeComp.compId":{handler:function(e,t){this._getDatasetMetadata()}}},data:function(){return{service:null,services:[{id:"admin",baseUrl:"http://10.10.50.15:6080/arcgis/rest/services/AdminArea/MapServer/",name:"行政区划",layers:[],enableDrill:!0,drillField:"LCODE",selectedLayers:[],selected:[]}],layerEdit:{selectedSev:"",serverObj:"",selectedLayer:[],layerObj:[],defaultParams:null},refGisField:null,refSetField:null,xAxisMetadataList:[],metaList:[],properties:[],spaceLimit:0,searchElementConfigs:[],operationTypes:f["a"],requireFields:[],globalParams:[],elementConfigsEditDialogVisible:!1,orderByConfigDTO:[],resultNumber:""}},mounted:function(){var e=this;this.$nextTick((function(){e._getDatasetMetadata()}))},methods:{_onResultNumberChange:function(){Object(r["d"])("conf ".concat(this.datasetSelectedId.toString()," resultNumber"),this.resultNumber)},initGisServer:function(){var e=this.activeComp.compId;if("themeLayer"===this.activeComp.compType){var t=this.activeComp.data.conf.sevLayer;t&&(this.layerEdit=m.a.cloneDeep(t));var a=this.activeComp.baseId;e=a||e}var i=this.getCompConf(e),l=m.a.cloneDeep(i.data.conf.services);l&&l.length>0&&(this.services=l);for(var n=0;n<this.services.length;n++)m.a.isEmpty(this.services[n].baseUrl)||this.getServerLayer(this.services[n])},request:function(e,t,a,i){return"GET"===i.toUpperCase()?this.service.get(e,{params:t}):"POST"===i.toUpperCase()?this.service.post(e,a,{params:t}):void 0},getServerLayer:function(e){"esri"===e.type?Object(y["a"])(e):"sm"===e.type?Object(y["b"])(e):Object(y["a"])(e)},_initData:function(){if(this.activeComp.data.conf[this.datasetSelectedId.toString()]){var e=this.datasetSelectedId.toString();this.refSetField=this.activeComp.data.conf[e].refSetField||null,this.refGisField=this.activeComp.data.conf[e].refGisField||null,this.properties=this.activeComp.data.conf[e].properties||[],this.requireFields=this.activeComp.data.conf[e].requireFields||[],this.globalParams=this.activeComp.data.conf[e].globalParams||[],this.searchElementConfigs=this.activeComp.data.conf[e].searchElementConfigs||[],this.orderByConfigDTO=this.activeComp.data.conf[e].orderByConfigDTO||[],this.resultNumber=this.activeComp.data.conf[e].resultNumber||"",this.activeComp.data.conf[e].datasetMeta}},serviceSelected:function(e){if(e)for(var t=0;t<this.services.length;t++)e===this.services[t].id&&(this.layerEdit.serverObj=this.services[t]);else this.layerEdit.serverObj=null},layerSelected:function(e){if(e){this.layerEdit.layerObj=[];for(var t=0;t<this.layerEdit.serverObj.selected.length;t++)-1!==e.indexOf(this.layerEdit.serverObj.selected[t].name)&&this.layerEdit.layerObj.push(this.layerEdit.serverObj.selected[t])}else this.layerEdit.layerObj=[];this.$store.commit("modifyValueByCompId",{attrs:[this.activeComp.compId,"data","conf","sevLayer"],value:m.a.cloneDeep(this.layerEdit)})},_getDatasetMetadata:function(){var e=m.a.cloneDeep(this.metaDataList);Object(r["d"])("conf ".concat(this.datasetSelectedId.toString()," datasetMeta"),e),this.metaList=m.a.cloneDeep(e),this.spaceMetaList=m.a.cloneDeep(e),this.initGisServer(),this._initData()},changeRefSetField:function(e){Object(r["d"])("conf ".concat(this.datasetSelectedId.toString()," refSetField"),e)},changeRefGisField:function(e){Object(r["d"])("conf ".concat(this.datasetSelectedId.toString()," refGisField"),e)},changePropertiesValue:function(e){Object(r["d"])("conf ".concat(this.datasetSelectedId.toString()," properties"),e)},_requireFieldsChanged:function(){Object(r["d"])("conf ".concat(this.datasetSelectedId.toString()," requireFields"),this.requireFields)},_elementConfigsEditClosed:function(){this.elementConfigsEditDialogVisible=!1},_updateElementConfigs:function(e){Object(r["d"])("conf ".concat(this.datasetSelectedId.toString()," searchElementConfigs"),e),this.searchElementConfigs=e,this.elementConfigsEditDialogVisible=!1},_addElementConfig:function(){this.elementConfigsEditDialogVisible=!0},_getOperationType:function(e){for(var t=0;t<this.operationTypes.length;t++)if(this.operationTypes[t].code===e)return this.operationTypes[t].description;return null},_updateOrderByConfigs:function(e){Object(r["d"])("conf ".concat(this.datasetSelectedId.toString()," orderByConfigDTO"),e),this.orderByConfigDTO=e,this.$refs.orderByConfig.hide()}}},v=g,_=(a("e38c"),a("2877")),C=Object(_["a"])(v,d,u,!1,null,null,null),S=C.exports,D=a("acde"),O={name:"gisSet",components:{gisSetBinding:S,showDataDialog:D["a"]},data:function(){return{datasetSelectedIds:[],datasetOptions:[],dialogVisible:!1}},created:function(){this._initData()},methods:{_onDiaologClosed:function(){this.dialogVisible=!1},_getMetaDataList:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=0;t<this.datasetOptions.length;t++)if(this.datasetOptions[t]["id"]===e)return this.datasetOptions[t]["datasetDetailList"];return[]},_initData:function(){var e=this;this.datasetOptions.length||s["a"].datasetsList().then((function(t){console.log("_initData -> res",t),200===t.code?e.datasetOptions=t.data:e.$message.info(t.message||"请求出错了,请重试！")})),this.datasetSelectedIds=this.activeComp.data.conf.datasetSelectedIds},_onDatasetChanged:function(){Object(r["d"])("conf datasetSelectedIds",this.datasetSelectedIds);for(var e=0;e<this.datasetSelectedIds.length;e++)Object(r["d"])("conf ".concat(this.datasetSelectedIds[e]),{});this.$evtBus.destroy(this.activeComp.compId)},_loadCompData:function(){try{this.$dm.clearErrorMsg(),this.$compsBus.$emit("updateCompData",{compId:this.activeComp.compId,changedLoadedData:this.updateState});var e=this.$dm.getErrorMsg();0!=e.length?this.$alert("加载数据失败。异常信息为"+e,"提示",{confirmButtonText:"确定"}):this.$alert("加载数据成功","提示",{confirmButtonText:"确定"})}catch(t){console.error("error:",t),this.$alert("加载数据失败。异常信息为"+t.message,"提示",{confirmButtonText:"确定"})}},getSelectDataSetName:function(e){for(var t=0;t<this.datasetOptions.length;t++)if(e==this.datasetOptions[t].id)return this.datasetOptions[t].name}},computed:Object(n["a"])(Object(n["a"])({},Object(o["c"])({activeComp:"getFirstActiveComp"})),{},{dataCfg:function(){return Object(c["a"])(this.activeComp.componentName)},multiDataset:function(){return this.activeComp.data.conf.multiDataset||!1}}),watch:{"activeComp.compId":{handler:function(e,t){this._initData()}}}},w=O,E=Object(_["a"])(w,i,l,!1,null,null,null);t["default"]=E.exports},2885:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"savedialog common-dialog edit-element-config",attrs:{"close-on-click-modal":!1,visible:e.visible,"append-to-body":!0,title:"组件数据筛选条件配置",width:"800px","show-close":!1,size:"mini"},on:{"update:visible":function(t){e.visible=t}}},[a("div",{staticClass:"header",staticStyle:{"margin-bottom":"5px","text-align":"right","padding-right":"16px"}},[a("el-button",{attrs:{type:"primary",icon:"el-icon-plus",circle:"",size:"mini"},on:{click:function(t){return t.stopPropagation(),e.addGlobalData(t)}}})],1),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.globalData,border:""}},[a("el-table-column",{attrs:{prop:"name",label:"条件字段"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-select",{staticStyle:{width:"100%"},attrs:{size:"mini"},model:{value:t.row.columnName,callback:function(a){e.$set(t.row,"columnName",a)},expression:"scope.row.columnName"}},e._l(e.metaList,(function(t){return a("el-option",{key:t.id,attrs:{label:t.columnName,value:t.columnName}},[a("span",[e._v(e._s(t.columnName)+"("+e._s(t.columnDesc)+")")])])})),1)]}}])}),a("el-table-column",{attrs:{prop:"operationType",label:"操作条件",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择条件",size:"mini"},model:{value:t.row.operationType,callback:function(a){e.$set(t.row,"operationType",a)},expression:"scope.row.operationType"}},e._l(e.operationTypes,(function(e){return a("el-option",{key:e.code,attrs:{label:e.description,value:e.code}})})),1)]}}])}),a("el-table-column",{attrs:{prop:"paramsFrom",label:"取值方式",width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-select",{staticStyle:{width:"100%"},attrs:{size:"mini"},on:{change:function(a){return e._onParamsFromChange(t.row,t.$index)}},model:{value:t.row.paramsFrom,callback:function(a){e.$set(t.row,"paramsFrom",a)},expression:"scope.row.paramsFrom"}},e._l(e.paramsFrom,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)]}}])}),a("el-table-column",{attrs:{label:"值/全局参数"},scopedSlots:e._u([{key:"default",fn:function(t){return[1===t.row.paramsFrom?a("el-input",{attrs:{size:"mini"},model:{value:t.row.value,callback:function(a){e.$set(t.row,"value",a)},expression:"scope.row.value"}}):a("el-select",{staticStyle:{width:"100%"},attrs:{size:"mini"},model:{value:t.row.value,callback:function(a){e.$set(t.row,"value",a)},expression:"scope.row.value"}},e._l(e.globalParamOptions,(function(e){return a("el-option",{key:e.name,attrs:{label:e.name,value:e.name}})})),1)]}}])}),a("el-table-column",{attrs:{prop:"operation",label:"操作",width:"80px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"danger",icon:"el-icon-delete",circle:"",size:"mini"},on:{click:function(a){return a.stopPropagation(),e.delGlobalData(t.$index)}}})]}}])})],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"primary-button",attrs:{type:"primary"},on:{click:e._confirm}},[e._v("确 定")]),a("el-button",{staticClass:"info-button",on:{click:e._onBack}},[e._v("取 消")])],1)],1)},l=[],n=(a("4160"),a("c975"),a("a434"),a("b0c0"),a("159b"),a("5530")),s=a("9cda"),o=[{label:"自定义",value:1},{label:"全局参数",value:2}],r=o,c=a("2f62"),d={name:"dataset-global-params-edit",props:{globalParams:{type:Array,default:[]},visible:{type:Boolean,default:!1},metaList:{type:Array,default:[]}},data:function(){return{globalData:[],operationTypes:s["a"],paramsFrom:r}},created:function(){this.globalData=_.cloneDeep(this.globalParams)},methods:{_getValueType:function(e,t){return 1===t?-1!==e.indexOf("${")?3:1:2},_confirm:function(){var e=this,t=[];this.globalData.forEach((function(a){a.value&&a.columnName&&(a.useType=e._getValueType(a.value,a.paramsFrom),t.push(a))})),this.$emit("onSave",t)},_onBack:function(){this.$emit("onBack")},addGlobalData:function(){this.globalData.push({operationType:"eq",paramsFrom:1,value:""})},delGlobalData:function(e){this.globalData.splice(e,1)},getGlobalVal:function(e){for(var t=0;t<this.globalParamOptions.length;t++)if(this.globalParamOptions[t]["name"]===e)return this.globalParamOptions[t]["value"];return""},_onParamsFromChange:function(e,t){e.value=""}},computed:Object(n["a"])(Object(n["a"])({},Object(c["d"])(["window"])),{},{globalParamOptions:function(){return this.window.globalParams}})},u=d,p=(a("b544"),a("2877")),m=Object(p["a"])(u,i,l,!1,null,"25f1e8f8",null);t["a"]=m.exports},"357f":function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"savedialog common-dialog edit-element-config",attrs:{"close-on-click-modal":!1,visible:e.visible,"append-to-body":!0,title:"数据排序配置",width:"800px","show-close":!1,size:"mini"},on:{"update:visible":function(t){e.visible=t}}},[a("div",{staticClass:"header",staticStyle:{"margin-bottom":"5px","text-align":"right","padding-right":"16px"}},[a("el-button",{attrs:{type:"primary",icon:"el-icon-plus",circle:"",size:"mini"},on:{click:function(t){return t.stopPropagation(),e.addOrderByData(t)}}})],1),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.orderByData,border:""}},[a("el-table-column",{attrs:{prop:"name",label:"排序字段"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-select",{staticStyle:{width:"100%"},attrs:{size:"mini"},model:{value:t.row.bindMapperColumn,callback:function(a){e.$set(t.row,"bindMapperColumn",a)},expression:"scope.row.bindMapperColumn"}},e._l(e.metaList,(function(t){return a("el-option",{key:t.id,attrs:{label:t.columnName,value:t.columnName}},[a("span",[e._v(e._s(t.columnName)+"("+e._s(t.columnDesc)+")")])])})),1)]}}])}),a("el-table-column",{attrs:{prop:"orderByType",label:"排序方式"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择排序方式",size:"mini"},model:{value:t.row.orderByType,callback:function(a){e.$set(t.row,"orderByType",a)},expression:"scope.row.orderByType"}},e._l(e.orderByTypes,(function(e){return a("el-option",{key:e.code,attrs:{label:e.description,value:e.code}})})),1)]}}])}),a("el-table-column",{attrs:{prop:"operation",label:"操作",width:"120px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"danger",icon:"el-icon-delete",circle:"",size:"mini"},on:{click:function(a){return a.stopPropagation(),e.delOrderByData(t.$index)}}})]}}])})],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"primary-button",attrs:{type:"primary"},on:{click:e._confirm}},[e._v("确 定")]),a("el-button",{staticClass:"info-button",on:{click:e.hide}},[e._v("取 消")])],1)],1)},l=[],n=(a("4de4"),a("a434"),{name:"dataset-orderby-params-edit",props:{globalParams:{type:Array,default:[]},metaList:{type:Array,default:[]}},data:function(){return{visible:!1,orderByData:[],orderByTypes:[{code:"asc",description:"正序"},{code:"desc",description:"倒序"}]}},created:function(){this.orderByData=_.cloneDeep(this.globalParams)},methods:{_confirm:function(){var e=this.orderByData.filter((function(e){return""!==e.bindMapperColumn}));this.$emit("onSave",e)},hide:function(){this.visible=!1},addOrderByData:function(){this.orderByData.push({orderByType:"asc",bindMapperColumn:""})},delOrderByData:function(e){this.orderByData.splice(e,1)},show:function(){this.visible=!0}}}),s=n,o=(a("8e06"),a("2877")),r=Object(o["a"])(s,i,l,!1,null,"c1ef89aa",null);t["a"]=r.exports},"5a34":function(e,t,a){var i=a("44e7");e.exports=function(e){if(i(e))throw TypeError("The method doesn't accept regular expressions");return e}},"785d":function(e,t,a){"use strict";a.d(t,"a",(function(){return r})),a.d(t,"b",(function(){return c}));a("c975"),a("fb6a"),a("b0c0"),a("d3b7"),a("ac1f"),a("8a79"),a("3ca3"),a("5319"),a("ddb0");var i=a("4f96"),l=a("bc3a"),n=a.n(l),s=n.a.create({baseURL:"",timeout:5e4});function o(e,t,a,i){return"GET"===i.toUpperCase()?s.get(e,{params:t}):"POST"===i.toUpperCase()?s.post(e,a,{params:t}):void 0}function r(e){o(e.baseUrl,{f:"json"},null,"GET").then((function(t){if(200===t.status){for(var a=t.data.layers,l=[],n=0;n<a.length;n++){var s=e.baseUrl.endsWith("/")?e.baseUrl:e.baseUrl+"/";l.push(o(s+a[n].id,{f:"json"},null,"GET"))}Promise.all(l).then((function(t){for(var l=Object(i["a"])(t),n=l.slice(0),s=0;s<n.length;s++){a[s].svType=e.type;var o=n[s].data.geometryType.replace("esriGeometry","");a[s].type="Polygon"===o?"面":"Polyline"===o?"线":"点",a[s].fields=[];for(var r=0;r<n[s].data.fields.length;r++){var c=n[s].data.fields[r];-1===c.name.toUpperCase().indexOf("OBJECTID")&&"SHAPE"!==c.name.toUpperCase()&&(c._type=c.type.replace("esriFieldType",""),c.columnName=c.name,c.columnDesc=c.alias,c.columnDefDire=2,"String"!==c._type&&"Date"!==c._type&&(c.columnDefDire=1),a[s].fields.push(c))}}e.layers=a}))}}))}function c(e){var t=e.baseUrl.endsWith("/")?e.baseUrl:e.baseUrl+"/",a=t+"datasources/"+e.datasource+"/datasets";o(a+".json",null,null,"GET",{withCredentials:!1}).then((function(l){if(200===l.status){for(var n=l.data.datasetNames,s=[],r=0;r<n.length;r++)s.push(o(a+"/"+n[r]+".json",null,null,"GET",{withCredentials:!1}));Promise.all(s).then((function(l){for(var n=Object(i["a"])(l),s=n.slice(0),r=function(l){var n={svType:e.type,baseUrl:t,fields:[],datasource:e.datasource,index:0,name:s[l].data.datasetInfo.name,selectedFields:[],serverName:e.name,type:null,url:t},r=s[l].data.datasetInfo.type;"REGION"===r?n.type="面":"LINE"===r?n.type="线":"POINT"===r&&(n.type="点");var c=a+"/"+n.name+"/fields.json";o(c,null,null,"GET",{withCredentials:!1}).then((function(t){for(var a=[],l=0;l<t.data.childUriList.length;l++)a.push(o(t.data.childUriList[l]+".json",null,null,"GET",{withCredentials:!1}));Promise.all(a).then((function(t){for(var a=Object(i["a"])(t),l=a.slice(0),s=0;s<l.length;s++){var o=l[s].data.fieldInfo,r={};-1===o.name.indexOf("Sm")&&(r.alias=o.caption,r.name=o.name,r._type=o.type,r.columnName=o.name,r.columnDesc=o.caption,r.columnDefDire=2,"TEXT"!==r._type&&"DATE"!==r._type&&(r.columnDefDire=1),n.fields.push(r))}e.layers.push(n)}))}))},c=0;c<s.length;c++)r(c)}))}}))}s.interceptors.request.use((function(e){return e}),(function(e){return Promise.reject(e)}))},"8a79":function(e,t,a){"use strict";var i=a("23e7"),l=a("06cf").f,n=a("50c4"),s=a("5a34"),o=a("1d80"),r=a("ab13"),c=a("c430"),d="".endsWith,u=Math.min,p=r("endsWith"),m=!c&&!p&&!!function(){var e=l(String.prototype,"endsWith");return e&&!e.writable}();i({target:"String",proto:!0,forced:!m&&!p},{endsWith:function(e){var t=String(o(this));s(e);var a=arguments.length>1?arguments[1]:void 0,i=n(t.length),l=void 0===a?i:u(n(a),i),r=String(e);return d?d.call(t,r,l):t.slice(l-r.length,l)===r}})},"8c02":function(e,t,a){},"8e06":function(e,t,a){"use strict";var i=a("c87b"),l=a.n(i);l.a},"9cda":function(e,t,a){"use strict";var i=[{code:"gt",name:">",description:"大于"},{code:"lt",name:"<",description:"小于"},{code:"eq",name:"=",description:"等于"},{code:"ne",name:"<>",description:"不等于"},{code:"gte",name:">=",description:"大于等于"},{code:"lte",name:"<=",description:"小于等于"},{code:"like",name:"like",description:"模糊查询"},{code:"likeLeft",name:"likeLeft",description:"左模糊查询"},{code:"likeRight",name:"likeRight",description:"右模糊查询"}];t["a"]=i},ab13:function(e,t,a){var i=a("b622"),l=i("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(a){try{return t[l]=!1,"/./"[e](t)}catch(i){}}return!1}},acde:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{attrs:{title:"查看数据",visible:e.visible,"modal-append-to-body":!1,"before-close":e.handleClose},on:{"update:visible":function(t){e.visible=t}}},[a("el-form",[a("el-form-item",[a("el-input",{staticStyle:{width:"100%"},attrs:{type:"textarea",value:e.compData,rows:15,disabled:!0}})],1),a("el-form-item",{staticStyle:{"text-align":"right","margin-bottom":"0"}},[a("el-button",{on:{click:function(t){return e.handleClose()}}},[e._v("关 闭")])],1)],1)],1)},l=[],n=a("5530"),s=a("2f62"),o={name:"show-data-dialog",props:{visible:{type:Boolean,default:!1}},data:function(){return{compData:null}},created:function(){var e=this;this.$dm.parseData(this.activeComp,"").then((function(t){200===t[0].code&&(e.compData=JSON.stringify(t[0].data.dataValues,null,4))}))},methods:{handleClose:function(){this.$emit("back")}},computed:Object(n["a"])({},Object(s["c"])({activeComp:"getFirstActiveComp"})),mounted:function(){}},r=o,c=a("2877"),d=Object(c["a"])(r,i,l,!1,null,null,null);t["a"]=d.exports},b544:function(e,t,a){"use strict";var i=a("8c02"),l=a.n(i);l.a},c87b:function(e,t,a){},e38c:function(e,t,a){"use strict";var i=a("0730"),l=a.n(i);l.a}}]);