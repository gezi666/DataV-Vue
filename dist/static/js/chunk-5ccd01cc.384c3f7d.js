(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5ccd01cc"],{"17f3":function(e,t,a){"use strict";a.d(t,"a",(function(){return n}));var n={CREATE:"create",RUNNING:"running",REDRAW:"redraw",RELOAD:"reload",DESTROY:"destroy"}},2532:function(e,t,a){"use strict";var n=a("23e7"),r=a("5a34"),o=a("1d80"),i=a("ab13");n({target:"String",proto:!0,forced:!i("includes")},{includes:function(e){return!!~String(o(this)).indexOf(r(e),arguments.length>1?arguments[1]:void 0)}})},"5a34":function(e,t,a){var n=a("44e7");e.exports=function(e){if(n(e))throw TypeError("The method doesn't accept regular expressions");return e}},a553:function(e,t,a){"use strict";a("4160"),a("caad"),a("c975"),a("277d"),a("d81d"),a("4e82"),a("b0c0"),a("07ac"),a("ac1f"),a("2532"),a("5319"),a("159b");var n=a("5530"),r=a("17f3"),o=a("2f62"),i=a("0e0b");t["a"]={name:"ComInterface",props:["compConf"],data:function(){return{chartData:null,compDataStatus:"loading"}},computed:Object(n["a"])({compId:function(){return this.compConf.compId},box:function(){return this.compConf.box},styleConf:function(){return this.compConf.style},dataConf:function(){if(this.compConf.data)return this.compConf.data.conf},dataSourceConf:function(){if(this.compConf.data)return this.compConf.data.datasource},compData:function(){return this.$store.state.compData.compData[this.compId]},linkageConf:function(){return this.compConf.linkage},state:function(){return this.compConf.state}},Object(o["c"])({activeCompData:"getCompData"})),watch:{styleConf:{handler:function(e,t){this.updateState(r["a"].REDRAW),this.styleConfChanged(e,t),this.updateState(r["a"].RUNNING)},deep:!0},state:{handler:function(e,t){},deep:!0},compData:{handler:function(e,t){e&&this.updateCompData(!0)},deep:!0},linkageConf:{handler:function(e,t){this.linkageConfChanged(e,t)},deep:!0},"dataSourceConf.type":{handler:function(e,t){this.$evtBus.destroy(this.compId)}}},methods:{convertExpression:function(e){if(-1!==JSON.stringify(e).indexOf("${")){var t=JSON.stringify(e);e=this._getExpressionValue(t),e=JSON.parse(e)}return e},styleConfChanged:function(){},compDataChanged:function(){},resize:function(){},convertChartData:function(e){},linkageConfChanged:function(e,t){},updateState:function(e){this.$emit("compState",e)},updateChartData:function(e){this.chartData=this.convertChartData(e)||e},_linkageDataKeys:function(e){var t=[];for(var a in e)e[a].data.forEach((function(e){t.push({bindMapperColumn:e.bindMapperColumn,value:e.value,operationType:e.operationType})}));return t},_getColumnCondition:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(1===e.useType)return{bindMapperColumn:e.columnName,dsId:t,operationType:e.operationType,value:e.value};if(2===e.useType){if(!a.length)return{};var n=this._getGlobalParamsValue(e.columnName,a);return n?{bindMapperColumn:e.columnName,dsId:t,operationType:e.operationType,value:n}:{}}e.value;var r=this._getExpressionValue(e.value);return r&&-1===r.indexOf("${")&&-1===r.indexOf("}")?{bindMapperColumn:e.columnName,dsId:t,operationType:e.operationType,value:r}:{}},_mergeElementConfig:function(e,t,a){var n=this,r=t.data.conf[e],o=_.cloneDeep(r.searchElementConfigs)||[];if(o.length){var i=a.state.window.globalParams;o.sort((function(e,t){return e.useType-t.useType}));var s={};o.forEach((function(t){var a=n._getColumnCondition(t,e,i);_.isEmpty(a)||(s[t.columnName]=a)})),_.isEmpty(s)||(o=Object.values(s))}var u=a.getters.getLinkagesByCompId(t["compId"]);if(_.isEmpty(u))return o;var c=o.map((function(e){return e.bindMapperColumn}))||[],f=this._linkageDataKeys(u);return f.forEach((function(t,a){var n=c.indexOf(t.bindMapperColumn);-1!==n?(o[a]["value"]=t.value,o[a].operationType=t.operationType):o.push({dsId:e,bindMapperColumn:t.bindMapperColumn,value:t.value,operationType:t.operationType})})),o},_checkRequireFields:function(){var e=this.compConf;if("dataset"===e.data.datasource.type){var t=e.data.conf.datasetSelectedIds;if(t&&Array.isArray(t)&&t.length){var a=e.data.conf.datasetSelectedIds[0],n=e.data.conf[a]["requireFields"];if(!n||!n.length)return!0;var r=this._mergeElementConfig(a,e,this.$store);if(!r.length)return!1;var o=r.map((function(e){return e.bindMapperColumn})),i=0;return n.forEach((function(e){-1!==o.indexOf(e)&&i++})),i===n.length}}return!0},updateCompData:function(e){if(e)this.compDataStatus="loaded",this.updateState(r["a"].RELOAD),this.compData&&(this.updateChartData(this.compData),this.compDataChanged(),this.updateState(r["a"].RUNNING));else if(["dataset"].includes(this.compConf.data.datasource.type)){var t=this._checkRequireFields();if(!t)return;var a=this.$dm._getFormatRequestParams(this.compConf),n=this.$store.getters.getConditionsByCompId(this.compConf.compId);(n.length<1||JSON.stringify(n[0].groupByConfig)!==JSON.stringify(a[0].groupByConfig)||JSON.stringify(n[0].orderByConfigDTO)!==JSON.stringify(a[0].orderByConfigDTO)||JSON.stringify(n[0].searchElementConfigs)!==JSON.stringify(a[0].searchElementConfigs))&&(this.compDataStatus="loading",this.$dm.initCompData(this.compConf))}else this.$dm.initCompData(this.compConf)},_mergeArr:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=[],n=e.length>t.length?e.length:t.length,r=0;r<n;r++){var o=e[r]?e[r]:t[r];a.push(o)}return a},_showNoDataBox:function(e){var t=document.getElementById("".concat(e)).querySelector("".concat(e,"_no_data_box"));if(!t){var a=document.createElement("div");a.id="".concat(e,"_no_data_box"),a.innerHTML="无数据",document.getElementById("".concat(e)).appendChild(a)}},_handleStaticData:function(){},_handleConditionExpression:function(){},_getCompLinkageParamsValue:function(e,t){var a=this.$store.getters.getLinkagesByCompId(t);if(!a)return null;if(a=a[e[0]],!a)return null;if(a=a["sourceData"],!a)return null;for(var n=1;n<e.length;n++){if(!a[e[n]])return null;a=a[e[n]]}return a},_getGlobalParamsValue:function(e){var t=this.$store.state.window.globalParams;if(!t||!t.length)return null;for(var a=0;a<t.length;a++)if(t[a].name===e)return t[a].value?t[a].value:null;return null},_getExpressionValue:function(e){var t=this,a=i["a"].getCustomExpressionParams(e),n=[];return a&&a.length&&a.forEach((function(e){var a=i["a"].getCustomExpressionCloumn(e);if(a.length>=2)if("global"===a[0]){var r=t._getGlobalParamsValue(a[1]);r?n.push(r):n.push(e)}else{var o=t._getCompLinkageParamsValue(a,t.compConf["compId"]);o?n.push(o):n.push(e)}else n.push(e)})),n.length&&a.forEach((function(t,a){e=e.replace(t,n[a])})),e},_convertEventOutData:function(e,t){if(!t||!t.datasource||"static"===t.datasource.type)return e;var a=t.conf[t.conf.datasetSelectedIds[0]]["datasetMeta"],n=_.cloneDeep(e);if(_.isObject(e)){var r=function(t){a.forEach((function(a){[a.columnDesc,a.columnName].includes(t)&&a.columnDesc&&(n[a.columnDesc]=e[t],n[a.columnName]=e[t])}))};for(var o in e)r(o);return n}return _.isArray(e)?(e.forEach((function(t,r){var o=function(o){a.forEach((function(a){[a.columnDesc,a.columnName].includes(o)&&a.columnDesc&&(n[r][a.columnDesc]=e[t][o],n[r][a.columnName]=e[t][o])}))};for(var i in e[t])o(i)})),n):n}}}},ab13:function(e,t,a){var n=a("b622"),r=n("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(a){try{return t[r]=!1,"/./"[e](t)}catch(n){}}return!1}},b897:function(e,t,a){"use strict";a("4160"),a("c975"),a("a15b"),a("fb6a"),a("4e82"),a("b0c0"),a("d3b7"),a("3ca3"),a("159b"),a("ddb0");var n=a("4f96"),r=(a("96cf"),a("1da1")),o=a("17f3"),i=a("a553");t["a"]={name:"AbstractGisComp",mixins:[i["a"]],props:["compConf","gisBase"],data:function(){return{}},methods:{convertChartData:function(e){},_convertDatasetToGeoJson:function(e){for(var t=this,a=[],n=function(n){var r={name:"",type:"",feats:[]};if(!t.dataConf[t.dataConf.datasetSelectedIds[n]])return"continue";var o=t.dataConf[t.dataConf.datasetSelectedIds[n]].geometry,i=t.dataConf[t.dataConf.datasetSelectedIds[n]].properties,s=t.dataConf[t.dataConf.datasetSelectedIds[n]].layer;if(!s||!o|!i)return"continue";if(!s.name||!s.type)return"continue";if(1!==o.length&&2!==o.length)return"continue";if(2===o.length&&"Point"===s.type)r.type="Point",e[n].forEach((function(e){r.name=e[s.name];var t={type:"Feature",geometry:{type:"Point",coordinates:[e[o[0]],e[o[1]]]},properties:{}};i.forEach((function(a){"layerName"===a&&(r.alias=e[a]),t.properties[a]=e[a]})),r.feats.push(t)}));else{if(1!==o.length||"Point"===s.type)return"continue";r.type=s.type,e[n].forEach((function(e){r.name=e[s.name];var t={type:"Feature",geometry:JSON.parse(e[o[0]]),properties:{}};i.forEach((function(a){"layerName"===a&&(r.alias=e[a]),t.properties[a]=e[a]})),r.feats.push(t)}))}a.push(r)},r=0;r<this.dataConf.datasetSelectedIds.length;r++)n(r);return a},relDataToSet:function(e,t,a,n){if(e&&e.length>0){for(var r=[],o=0;o<this.gisData.length;o++){for(var i={type:this.gisData[o].type,index:0,datasetMeta:this.gisData[o].datasetMeta,name:this.gisData[o].name,feats:[]},s=0;s<this.gisData[o].feats.length;s++)for(var u=this.gisData[o].feats[s],c=0;c<e.length;c++)if(u.properties[a]===e[c][n]){var f=Object.assign({},u.properties,e[c]),l=_.cloneDeep(u);l.properties=f,i.feats.push(l)}i.feats.length>0&&r.push(i)}return r}return this.gisData},loadGisServer:function(e){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function a(){var n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(n=_.cloneDeep(t.compConf.data.conf.sevLayer),"sm"!==n.serverObj.type){a.next=7;break}return a.next=4,t.loadGisServerSm(e);case 4:return a.abrupt("return",a.sent);case 7:return a.next=9,t.loadGisServerEsri(e);case 9:return a.abrupt("return",a.sent);case 10:case"end":return a.stop()}}),a)})))()},loadGisServerEsri:function(e){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function a(){var r,o,i,s,u,c,f,l,d;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(r=_.cloneDeep(t.compConf.data.conf.sevLayer),!(r&&r.layerObj.length>0)){a.next=9;break}for(r.layerObj.sort((function(e,t){return e.index>=t.index?1:-1})),t.defaultParams=r.defaultParams,o=[],i=0;i<r.layerObj.length;i++)s=r.layerObj[i],u=s.url,c=_.cloneDeep(s.selectedFields),f={},-1!==c.indexOf("*")?f.outFields="*":(l=c.join(","),f.outFields=l),d=t.gisBase.queryGisData(u,f),o.push(d);return a.next=8,Promise.all(o).then((function(t){for(var a=Object(n["a"])(t),o=a.slice(0),i=[],s=0;s<o.length;s++){for(var u={type:e,index:r.layerObj[s].index,datasetMeta:[],name:r.layerObj[s].name,feats:o[s].features},c=0;c<r.layerObj[s].fields.length;c++)-1===r.layerObj[s].selectedFields.indexOf(r.layerObj[s].fields[c].name)&&-1===r.layerObj[s].selectedFields.indexOf("*")||u.datasetMeta.push(r.layerObj[s].fields[c]);i.push(u)}return i}));case 8:return a.abrupt("return",a.sent);case 9:return a.abrupt("return",[]);case 10:case"end":return a.stop()}}),a)})))()},loadGisServerSm:function(e){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function a(){var r,o,i,s,u,c,f,l,d;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(r=_.cloneDeep(t.compConf.data.conf.sevLayer),!(r&&r.layerObj.length>0)){a.next=27;break}r.layerObj.sort((function(e,t){return e.index>=t.index?1:-1})),t.defaultParams=r.defaultParams,o=[],i=0;case 6:if(!(i<r.layerObj.length)){a.next=24;break}if(s=r.layerObj[i],u=s.url,c={datasource:s.datasource,name:s.name},f=_.cloneDeep(s.selectedFields),-1!==f.indexOf("*")){a.next=15;break}c.fields=f,a.next=19;break;case 15:return a.next=17,t.gisBase.fieldsService(u,c);case 17:l=a.sent,c.fields=l;case 19:d=t.gisBase.queryGisDataSm(u,c),o.push(d);case 21:i++,a.next=6;break;case 24:return a.next=26,Promise.all(o).then((function(t){for(var a=Object(n["a"])(t),o=a.slice(0),i=[],s=0;s<o.length;s++){for(var u={type:e,index:r.layerObj[s].index,datasetMeta:[],name:r.layerObj[s].name,feats:o[s].features},c=0;c<r.layerObj[s].fields.length;c++)-1===r.layerObj[s].selectedFields.indexOf(r.layerObj[s].fields[c].name)&&-1===r.layerObj[s].selectedFields.indexOf("*")||u.datasetMeta.push(r.layerObj[s].fields[c]);i.push(u)}return i}));case 26:return a.abrupt("return",a.sent);case 27:return a.abrupt("return",[]);case 28:case"end":return a.stop()}}),a)})))()}},created:function(){this.updateState(o["a"].CREATE)},mounted:function(){var e=Object(r["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.updateChartData(this.compData);case 2:this.updateState(o["a"].RUNNING),this.linkageConfChanged();case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),destroyed:function(){this.updateState(o["a"].DESTROY)}}}}]);