(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7b26fe77"],{"17f3":function(n,t,e){"use strict";e.d(t,"a",(function(){return a}));var a={CREATE:"create",RUNNING:"running",REDRAW:"redraw",RELOAD:"reload",DESTROY:"destroy"}},2532:function(n,t,e){"use strict";var a=e("23e7"),o=e("5a34"),r=e("1d80"),i=e("ab13");a({target:"String",proto:!0,forced:!i("includes")},{includes:function(n){return!!~String(r(this)).indexOf(o(n),arguments.length>1?arguments[1]:void 0)}})},"5a34":function(n,t,e){var a=e("44e7");n.exports=function(n){if(a(n))throw TypeError("The method doesn't accept regular expressions");return n}},7031:function(n,t,e){"use strict";var a=e("17f3"),o=e("a553");t["a"]={name:"AbstractComp",mixins:[o["a"]],data:function(){return{chartData:null,nextIndex:0,compDataStatus:"loading",defaultColors:["#04d6ef","#ef58ea","#ff9e87","#0cc2ff","#fad860","#9bca63","#fe8463","#975fe5","#dc81d2","#8d98b3"]}},watch:{compDataStatus:{handler:function(n){"loading"===n&&this.chartLoading()}}},methods:{draw:function(){},chartLoading:function(){this.myChart&&this.myChart.showLoading({text:"",color:"#666",textColor:"#fff",maskColor:"rgba(115, 170, 229, 0)",zlevel:0,fontSize:30,showSpinner:!0,spinnerRadius:10,lineWidth:5})},_toggleCompShow:function(){var n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],e=arguments.length>2?arguments[2]:void 0;n&&(document.getElementById("".concat(e)).style.transition=t?"all .3s ease-out":"",document.getElementById("".concat(e)).style.transform=t?"scale(1)":"scale(0)")}},created:function(){this.updateState(a["a"].CREATE)},mounted:function(){var n=this;this.updateChartData(this.compData),this.draw(),this.updateState(a["a"].RUNNING),this.$nextTick((function(){n.linkageConfChanged()}))},destroyed:function(){this.updateState(a["a"].DESTROY)},render:function(n){var t=this.compConf.compId;return n("div",{attrs:{id:t},style:{left:"0px",top:"0px",width:"100%",height:"100%",position:"absolute"}})}}},a553:function(n,t,e){"use strict";e("4160"),e("caad"),e("c975"),e("277d"),e("d81d"),e("4e82"),e("b0c0"),e("07ac"),e("ac1f"),e("2532"),e("5319"),e("159b");var a=e("5530"),o=e("17f3"),r=e("2f62"),i=e("0e0b");t["a"]={name:"ComInterface",props:["compConf"],data:function(){return{chartData:null,compDataStatus:"loading"}},computed:Object(a["a"])({compId:function(){return this.compConf.compId},box:function(){return this.compConf.box},styleConf:function(){return this.compConf.style},dataConf:function(){if(this.compConf.data)return this.compConf.data.conf},dataSourceConf:function(){if(this.compConf.data)return this.compConf.data.datasource},compData:function(){return this.$store.state.compData.compData[this.compId]},linkageConf:function(){return this.compConf.linkage},state:function(){return this.compConf.state}},Object(r["c"])({activeCompData:"getCompData"})),watch:{styleConf:{handler:function(n,t){this.updateState(o["a"].REDRAW),this.styleConfChanged(n,t),this.updateState(o["a"].RUNNING)},deep:!0},state:{handler:function(n,t){},deep:!0},compData:{handler:function(n,t){n&&this.updateCompData(!0)},deep:!0},linkageConf:{handler:function(n,t){this.linkageConfChanged(n,t)},deep:!0},"dataSourceConf.type":{handler:function(n,t){this.$evtBus.destroy(this.compId)}}},methods:{convertExpression:function(n){if(-1!==JSON.stringify(n).indexOf("${")){var t=JSON.stringify(n);n=this._getExpressionValue(t),n=JSON.parse(n)}return n},styleConfChanged:function(){},compDataChanged:function(){},resize:function(){},convertChartData:function(n){},linkageConfChanged:function(n,t){},updateState:function(n){this.$emit("compState",n)},updateChartData:function(n){this.chartData=this.convertChartData(n)||n},_linkageDataKeys:function(n){var t=[];for(var e in n)n[e].data.forEach((function(n){t.push({bindMapperColumn:n.bindMapperColumn,value:n.value,operationType:n.operationType})}));return t},_getColumnCondition:function(n,t){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(1===n.useType)return{bindMapperColumn:n.columnName,dsId:t,operationType:n.operationType,value:n.value};if(2===n.useType){if(!e.length)return{};var a=this._getGlobalParamsValue(n.columnName,e);return a?{bindMapperColumn:n.columnName,dsId:t,operationType:n.operationType,value:a}:{}}n.value;var o=this._getExpressionValue(n.value);return o&&-1===o.indexOf("${")&&-1===o.indexOf("}")?{bindMapperColumn:n.columnName,dsId:t,operationType:n.operationType,value:o}:{}},_mergeElementConfig:function(n,t,e){var a=this,o=t.data.conf[n],r=_.cloneDeep(o.searchElementConfigs)||[];if(r.length){var i=e.state.window.globalParams;r.sort((function(n,t){return n.useType-t.useType}));var c={};r.forEach((function(t){var e=a._getColumnCondition(t,n,i);_.isEmpty(e)||(c[t.columnName]=e)})),_.isEmpty(c)||(r=Object.values(c))}var u=e.getters.getLinkagesByCompId(t["compId"]);if(_.isEmpty(u))return r;var s=r.map((function(n){return n.bindMapperColumn}))||[],f=this._linkageDataKeys(u);return f.forEach((function(t,e){var a=s.indexOf(t.bindMapperColumn);-1!==a?(r[e]["value"]=t.value,r[e].operationType=t.operationType):r.push({dsId:n,bindMapperColumn:t.bindMapperColumn,value:t.value,operationType:t.operationType})})),r},_checkRequireFields:function(){var n=this.compConf;if("dataset"===n.data.datasource.type){var t=n.data.conf.datasetSelectedIds;if(t&&Array.isArray(t)&&t.length){var e=n.data.conf.datasetSelectedIds[0],a=n.data.conf[e]["requireFields"];if(!a||!a.length)return!0;var o=this._mergeElementConfig(e,n,this.$store);if(!o.length)return!1;var r=o.map((function(n){return n.bindMapperColumn})),i=0;return a.forEach((function(n){-1!==r.indexOf(n)&&i++})),i===a.length}}return!0},updateCompData:function(n){if(n)this.compDataStatus="loaded",this.updateState(o["a"].RELOAD),this.compData&&(this.updateChartData(this.compData),this.compDataChanged(),this.updateState(o["a"].RUNNING));else if(["dataset"].includes(this.compConf.data.datasource.type)){var t=this._checkRequireFields();if(!t)return;var e=this.$dm._getFormatRequestParams(this.compConf),a=this.$store.getters.getConditionsByCompId(this.compConf.compId);(a.length<1||JSON.stringify(a[0].groupByConfig)!==JSON.stringify(e[0].groupByConfig)||JSON.stringify(a[0].orderByConfigDTO)!==JSON.stringify(e[0].orderByConfigDTO)||JSON.stringify(a[0].searchElementConfigs)!==JSON.stringify(e[0].searchElementConfigs))&&(this.compDataStatus="loading",this.$dm.initCompData(this.compConf))}else this.$dm.initCompData(this.compConf)},_mergeArr:function(){for(var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],e=[],a=n.length>t.length?n.length:t.length,o=0;o<a;o++){var r=n[o]?n[o]:t[o];e.push(r)}return e},_showNoDataBox:function(n){var t=document.getElementById("".concat(n)).querySelector("".concat(n,"_no_data_box"));if(!t){var e=document.createElement("div");e.id="".concat(n,"_no_data_box"),e.innerHTML="无数据",document.getElementById("".concat(n)).appendChild(e)}},_handleStaticData:function(){},_handleConditionExpression:function(){},_getCompLinkageParamsValue:function(n,t){var e=this.$store.getters.getLinkagesByCompId(t);if(!e)return null;if(e=e[n[0]],!e)return null;if(e=e["sourceData"],!e)return null;for(var a=1;a<n.length;a++){if(!e[n[a]])return null;e=e[n[a]]}return e},_getGlobalParamsValue:function(n){var t=this.$store.state.window.globalParams;if(!t||!t.length)return null;for(var e=0;e<t.length;e++)if(t[e].name===n)return t[e].value?t[e].value:null;return null},_getExpressionValue:function(n){var t=this,e=i["a"].getCustomExpressionParams(n),a=[];return e&&e.length&&e.forEach((function(n){var e=i["a"].getCustomExpressionCloumn(n);if(e.length>=2)if("global"===e[0]){var o=t._getGlobalParamsValue(e[1]);o?a.push(o):a.push(n)}else{var r=t._getCompLinkageParamsValue(e,t.compConf["compId"]);r?a.push(r):a.push(n)}else a.push(n)})),a.length&&e.forEach((function(t,e){n=n.replace(t,a[e])})),n},_convertEventOutData:function(n,t){if(!t||!t.datasource||"static"===t.datasource.type)return n;var e=t.conf[t.conf.datasetSelectedIds[0]]["datasetMeta"],a=_.cloneDeep(n);if(_.isObject(n)){var o=function(t){e.forEach((function(e){[e.columnDesc,e.columnName].includes(t)&&e.columnDesc&&(a[e.columnDesc]=n[t],a[e.columnName]=n[t])}))};for(var r in n)o(r);return a}return _.isArray(n)?(n.forEach((function(t,o){var r=function(r){e.forEach((function(e){[e.columnDesc,e.columnName].includes(r)&&e.columnDesc&&(a[o][e.columnDesc]=n[t][r],a[o][e.columnName]=n[t][r])}))};for(var i in n[t])r(i)})),a):a}}}},ab13:function(n,t,e){var a=e("b622"),o=a("match");n.exports=function(n){var t=/./;try{"/./"[n](t)}catch(e){try{return t[o]=!1,"/./"[n](t)}catch(a){}}return!1}},ee5d:function(n,t,e){"use strict";e.d(t,"a",(function(){return I})),e.d(t,"b",(function(){return _})),e.d(t,"e",(function(){return d})),e.d(t,"f",(function(){return h})),e.d(t,"c",(function(){return p})),e.d(t,"d",(function(){return w})),e.d(t,"g",(function(){return A}));e("99af"),e("4160"),e("a630"),e("caad"),e("d81d"),e("4e82"),e("b64b"),e("d3b7"),e("07ac"),e("acd8"),e("6062"),e("2532"),e("3ca3"),e("159b"),e("ddb0"),e("c975"),e("b0c0");var a=function(n){var t={};return n.forEach((function(n){return t[n.columnName]=n})),t},o=function(n,t){var e={dimensions:0,indi:0};return n?(n.forEach((function(n){return 1==t[n]["columnDefDire"]?e.indi++:e.dimensions++})),e):e},r=function(n,t){var e=a(n),o={dimensions:[],indi:[]};return t.forEach((function(n){return 1==e[n]["columnDefDire"]?o.indi.push(e[n]["columnName"]):o.dimensions.push(e[n]["columnName"])})),o},i=function(n,t,e){var a=null;e||(e="legend"),n.forEach((function(n){e==n.name&&(a=n)})),a?a.data.push(t):(a={name:e||"legend",data:[t]},n.push(a))},c=function(n,t){-1==n.indexOf(t)&&n.push(t)},u=function(n){var t={};return n.forEach((function(n){return t[n.columnName]=n})),t},s=function(n){for(var t=0;t<n.length;t++)if(2===n[t].columnDefDire)return n[t].columnName;return""},f=function(n,t,e){var a=u(t),o=[];e.forEach((function(n){1==a[n]["columnDefDire"]&&o.push(n)}));var r=s(t),i={};for(var c in n&&n.length&&n.forEach((function(n){i[n[r]]||(i[n[r]]={}),o.forEach((function(t){i[n[r]][t]||(i[n[r]][t]=0),i[n[r]][t]+=n[t]}))})),o.forEach((function(n,t){a[n]["columnDesc"]&&(o[t]={name:a[n]["columnDesc"]})})),i)i[c]=Object.values(i[c]);return{indicator:o,seriesData:i}},d=f,l=function(n,t){if(0==n.length)return{name:"",value:0};var e=n[0];return{name:e[t.name],value:e[t.value]}},h=l,m=function(n,t){if(0==n.length)return{name:"",value:0};var e=n[0];return{value:e[t.value]}},p=m,v=e("ade3"),g=e("5530"),C=function(n,t,e,o){a(o);var r=[];return n&&n.forEach((function(n){r.push(Object(g["a"])(Object(v["a"])({},"".concat(e),n[e]),n))})),r},D=function(n,t,e,a){var o=r(a,t),i=o["dimensions"][0],c={};n.forEach((function(n){c[n[i]]=n[i]}));var u=[];for(var s in c){var f;u.push((f={},Object(v["a"])(f,"".concat(e),s),Object(v["a"])(f,"value",c[s]),Object(v["a"])(f,"sourceName",i),f))}return u},y=e("2ef0"),E=e.n(y),x=function(n,t){var e={classify:[],legends:[]};return n.forEach((function(n,a,o){c(e.classify,n[t.classify]),i(e.legends,n[t.value],n[t.legend])})),e},b=function(){return{classify:[],data:[]}},S=function(n,t){var e=t.xAxisIds,r=a(t.datasetMeta),i=o(e,r),c={};if(i.dimensions>=1&&i.indi>=1){var u=[],s=[];e.forEach((function(n){return 1==r[n]["columnDefDire"]?s.push(n):u.push(n)}));var f=u[0],d=s[0];return n.forEach((function(n){c[n[f]]||(c[n[f]]=0),c[n[f]]+=parseFloat(n[d])})),[c]}return 0===i.dimensions?(n.forEach((function(n){e.forEach((function(t){var e=r[t]["columnDesc"]?r[t]["columnDesc"]:t;c[e]||(c[e]=0),c[e]+=n[t]||0}))})),[c]):[]},I=function(n,t){return n&&t?x(n,t):(console.warn("cannot parse data with getColumnData"),b())},_=function(n,t){return n&&t?S(n,t):(console.warn("cannot parse data with getColumnData"),{dataSource:[],dimensions:""})},N=function(n,t){var e,o=a(t.datasetMeta),r=t.xAxisIds.concat(t.yAxisIds),i=new Set,c={},u=[];r.forEach((function(n){return 1==o[n]["columnDefDire"]?u.push(n):e=n})),i.add(e),u.forEach((function(n){return i.add(n)}));var s=new Set;n.forEach((function(n){return s.add(n[e])})),s=Array.from(s);var f=Array.from(i);n.forEach((function(n){var t="dimension"+n[e];c[t]||(c[t]={}),f.forEach((function(a){var r=o[a]["columnDesc"]?o[a]["columnDesc"]:o[a]["columnName"];c[t][r]||(c[t][r]=0),a!==e?c[t][r]+=parseFloat(n[a])||0:c[t][r]=parseFloat(n[a])}))}));for(var d=0;d<f.length;d++)f[d]=o[f[d]]["columnDesc"]?o[f[d]]["columnDesc"]:o[f[d]]["columnName"];return{dataSource:Object.values(c),dimensions:f}},O=function(n,t){var e=a(t.datasetMeta),o=!1;if(t.xAxisIds.length)for(var r=0;r<t.xAxisIds.length;r++)if(1==e[t.xAxisIds[r]]["columnDefDire"]){o=!0;break}var i=t.xAxisIds.concat(t.yAxisIds),c=E.a.cloneDeep(i),u={};n.forEach((function(n){c.forEach((function(t){var a=e[t]["columnDesc"];u[a]||(u[a]=0),u[a]+=parseFloat(n[t])||0}))}));for(var s=0;s<c.length;s++)c[s]=e[c[s]]["columnDesc"];return o||(u["_product$_"]="",c.unshift("_product$_")),{dimensions:c,dataSource:[u]}},w=function(n,t){var e=t.xAxisIds.concat(t.yAxisIds),r=a(t.datasetMeta),i=o(e,r);if(1===i.dimensions&&i.indi>=1)return N(n,t);if(0===i.dimensions)return O(n,t);var c=[],u=new Set,s=[],f={};t.xAxisIds.concat(t.yAxisIds).forEach((function(t){1==r[t]["columnDefDire"]?c.push(t):(f[t]=new Set,n.forEach((function(n){f[t].add(n[t])})))}));var d=Object.keys(f),l="";return d.forEach((function(n){t.xAxisIds.concat(t.yAxisIds).includes(n)&&(l=n)})),u.add(l),f[l].forEach((function(t){var e={};if(e[l]=t,d.forEach((function(a){a!==l&&f[a].forEach((function(o){u.add(o);var r=0;c.forEach((function(e){n.forEach((function(n){n[a]===o&&n[l]===t&&(r+=parseFloat(n[e])||0)}))})),e[t]||(e[t]=0),e[t]+=r,e[o]||(e[o]=0),e[o]+=r}))})),1===d.length){u.add(t);var a=0;c.forEach((function(e){n.forEach((function(n){n[l]===t&&(a+=parseFloat(n[e])||0)}))})),e[t]||(e[t]=0),e[t]+=a}s.push(e)})),{dataSource:s,dimensions:Array.from(u)}},A=function(n,t,e){var r=t.xAxisIds,i=a(t.datasetMeta),c=o(r,i);return c.dimensions?D(n,r,e,t.datasetMeta):C(n,r,e,t.datasetMeta)}}}]);