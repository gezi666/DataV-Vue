(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0cf66a"],{"640f":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div")},n=[],o=(i("99af"),i("4160"),i("c975"),i("b0c0"),i("b64b"),i("acd8"),i("ac1f"),i("1276"),i("159b"),i("ade3")),s=(i("96cf"),i("1da1")),r=i("b897"),l=i("e11e"),c=i("0e0b"),f={name:"pointVector",mixins:[r["a"]],data:function(){return{pStyles:null,refType:"",clickStyle:{},hoverStyle:{},data:[],gisData:[],layerObj:null,defaultParams:null,showLayer:!0}},created:function(){this.showLayer=this.styleConf.defaultShowLayer,this.processStyle(this.styleConf.refType)},methods:{styleConfChanged:function(){this.refType!==this.styleConf.refType&&(this.pStyles=null,this.refType=this.styleConf.refType),this.processStyle(this.styleConf.refType),this.notifyBase()},convertChartData:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function i(){var a,n,o,s,r,l,c,f;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if("dataset"!==t.compConf.data.datasource.type){i.next=5;break}for(a=t._convertDatasetToGeoJson(e),n=0;n<a.length;n++){for(o=!1,s=0;s<t.data.length;s++)t.data[s].name===a[n].name&&(t.data[s]=a[n],o=!0);o||t.data.push(a[n])}i.next=21;break;case 5:if("gisServer"!==t.compConf.data.datasource.type){i.next=11;break}return i.next=8,t.loadGisServer("Point");case 8:t.data=i.sent,i.next=21;break;case 11:if("gisSet"!==t.compConf.data.datasource.type){i.next=20;break}if(r=_.cloneDeep(t.compConf.data.conf.sevLayer),!(r&&r.layerObj&&r.layerObj.length>0)){i.next=17;break}return i.next=16,t.loadGisServer("Point");case 16:t.gisData=i.sent;case 17:t.dataConf.datasetSelectedIds.length>0&&t.dataConf[t.dataConf.datasetSelectedIds[0]]&&(l=t.dataConf[t.dataConf.datasetSelectedIds[0]].properties,c=t.dataConf[t.dataConf.datasetSelectedIds[0]].refGisField,f=t.dataConf[t.dataConf.datasetSelectedIds[0]].refSetField,l&&l.length>0&&c&&f&&(-1===l.indexOf(f)&&t.$message({type:"error",message:"数据集中不包含关联字段，请重新选择"}),t.data=t.relDataToSet(e,l,c,f))),i.next=21;break;case 20:t.data=e;case 21:t.notifyBase(),t.bindEvent();case 23:case"end":return i.stop()}}),i)})))()},processStyle:function(e){this.clickStyle=this.styleConf.clickStyle,this.hoverStyle=this.styleConf.hoverStyle;var t={unique:{index:0,style:[]},clazz:{},range:{}};switch(e){case"unique":t.unique.style=this._styleParser(this.styleConf.refInfo.pointStyles,e);break;case"clazz":t.clazz=this._styleParser(this.styleConf.refInfo["class"],e);break;case"range":t.range=this._styleParser(this.styleConf.refInfo.seg,e);break}this.pStyles=t},_styleParser:function(e,t){var i;return i="unique"===t?[]:{},e.forEach((function(e){var a=null;a="imgIcon"===e.iconType?l["icon"]({iconUrl:e.iconUrl,iconSize:[e.pWidth,e.pHeight]}):"pulseIcon"===e.iconType?l["icon"].pulse({iconSize:[e.pWidth,e.pHeight],color:e.iconColor,fillColor:e.iconColor}):l["divIcon"]({html:'<div style="background-color:'.concat(e.iconColor,';width:100%;border-radius: 50%;height: 100%"></div>'),iconSize:[e.pWidth,e.pHeight],className:"div-icon"}),a.iconType=e.iconType;var n={icon:a,opacity:e.opacity,bkIcon:a};"unique"===t?i.push(n):"clazz"===t?(n.clz=e.clz,i[n.clz]=n):"range"===t?(n.f=e.f,n.t=e.t,i["".concat(n.f,"-").concat(n.t)]=n):i[t]=n})),i},buildPointVector:function(e){var t=this,i=this.styleConf.refType,a=this.styleConf.ref;this.styleConf.dynamicRef&&(a=this.convertExpression(this.styleConf.ref),-1!==a.indexOf("${")&&this.defaultParams&&(a=this.convertExpression(this.defaultParams)));var n=this.styleConf.name,o=l["layerGroup"]();o.id=c["a"].guid(),o.name=n&&""!==n?n:"point_"+c["a"].guid();for(var s=this,r=e.feats,f=0;f<r.length;f++){var h=r[f],d=this._calcStyle(i,a,h.properties);if(d){var p=l["marker"]([h.geometry.coordinates[1],h.geometry.coordinates[0]],d);if(p.properties=h.properties,this.styleConf.tooltip&&this.styleConf.tooltip.enable){var y=s.generateTipContent(h.properties);y&&""!==y&&p.bindTooltip(y,{offset:[20,-10],direction:"right",className:"dark-tip"})}p.on("click",(function(e){var i=t;t.featClick(i,e)})),p.on("mouseover",(function(e){var i=t;t.featHover(i,e)})),p.on("mouseout",(function(e){var i=t;t.featStatusClean(i,e)})),o.addLayer(p),p._group=o}}return 0===o.getLayers().length?null:o},_calcStyle:function(e,t,i){if(!t||""===t||!i.hasOwnProperty(t))return null;var a=i[t];if("unique"===e){var n=this.styleConf.refInfo.filters.split(",");if(""===a||-1===n.indexOf(a)){var o=this.pStyles.unique;if(o.style.length>0){if(o.index<o.style.length){var s=o.style[o.index];return o.index=o.index+1,s}return o.index=0,o.style[o.index]}}}else if("clazz"===e){var r=this.pStyles.clazz;if(Object.keys(r).length>0)for(var l in r)if(a===l)return r[l]}else if("range"===e){var c=this.pStyles.range;if(a=parseFloat(a),Object.keys(c).length>0){var f=null;for(var h in c){if(f)break;var d=parseFloat(h.split("-")[0]),p=parseFloat(h.split("-")[1]);f=d<=p?a>=d&&a<p?c[h]:null:a>=p&&a<d?c[h]:null}return f}}return null},generateTipContent:function(e){if(0===this.styleConf.tooltip.items.length)return null;for(var t=this.styleConf.tooltip.items,i='<div style="padding: 10px;width: auto">',a={},n=0;n<t.length;n++){var o=t[n];a[o.ref]=o.refAlias}var s=this.styleConf.ref;for(var r in this.styleConf.dynamicRef&&(s=this.convertExpression(this.styleConf.ref)),e){var l=void 0;if(r===s&&(l=this.styleConf.ref),a.hasOwnProperty(r)||a.hasOwnProperty(l)){var c=a[r]&&""!==a[r]?a[r]:r;a.hasOwnProperty(l)&&(c=a[l]),i+='<div style="display: flex">\n                               <div style="max-width:140px;text-align: right">'.concat(c.toUpperCase(),'：</div>\n                               <div style="text-align: left">').concat(e[r],"</div>\n                               </div>")}}return i+="</div>",i},featClick:function(e,t){if(this.clickStyle&&this.clickStyle.enable){var i=null;if(t.target._group.eachLayer((function(e){e.setIcon(e.options.bkIcon),e.selected&&(i=e)})),t.target.selected)return void(t.target.selected=!1);i&&i._leaflet_id!==t.target._leaflet_id&&(i.selected=!1);var a=this._styleParser([this.clickStyle],"click");a.click.bkClickIcon=t.target.options.icon,a.click.bkIcon=t.target.options.bkIcon,t.target.setIcon(a.click.icon),t.target.selected=!0}},featHover:function(e,t){if(this.hoverStyle&&this.hoverStyle.enable){if(t.target._group.eachLayer((function(e){e.selected||(e.setIcon(e.options.bkIcon),e.closeTooltip())})),t.target.selected)return;var i=this._styleParser([this.hoverStyle],"hover");i.hover.bkHoverIcon=t.target.options.icon,i.hover.bkIcon=t.target.options.bkIcon,t.target.setIcon(i.hover.icon),this.styleConf.tooltip&&this.styleConf.tooltip.enable&&t.target.openTooltip()}},featStatusClean:function(e,t){t.target._group.eachLayer((function(e){e.selected||(e.setIcon(e.options.bkIcon),e.closeTooltip())}))},_updateDataMeta:function(e){this.$store.getters.getPreviewState?this.$store.commit("modifyValueByGIS",{attrs:[this.compConf.compId,"data","conf","datasetMeta"],value:e}):this.$store.commit("modifyValueByCompId",{attrs:[this.compConf.compId,"data","conf","datasetMeta"],value:e})},notifyBase:function(){if(this.gisBase){if(this.data&&this.data.length>0){var e=this.data[0];"gisServer"===this.compConf.data.datasource.type&&this._updateDataMeta(e.datasetMeta),this.layerObj=this.buildPointVector(e)}else this.layerObj=null;this.layerObj?this.$emit("updateVecLayer",{id:this.compConf.compId,show:this.showLayer,type:"point",layerObj:this.layerObj}):this.$emit("clearVecLayer",{id:this.compConf.compId,show:this.showLayer})}},getStyleObj:function(){if(!this.styleConf.legend||!this.layerObj)return null;var e=this.pStyles[this.styleConf.refType],t=[];if(e.hasOwnProperty("style")&&e.hasOwnProperty("index"))for(var i=0;i<e.style.length;i++)t.push({name:"",style:e.style[i]});else for(var a in e)t.push({name:a,style:e[a]});return{id:this.layerObj.id,name:this.compConf.name,type:"Point",list:t}},linkageConfChanged:function(){this.$store.getters.getPreviewState||this.bindEvent()},bindEvent:function(){if(this.compConf.linkage&&this.compConf.linkage.linkRevEvents)for(var e=this.compConf.linkage.linkRevEvents,t=0;t<e.length;t++){var i=e[t],a=i.evtName.split(":")[1];"click"===a&&this._clickByLinkAge(i)}},toggleShow:function(e,t){if(!this.layerObj&&this.gisBase&&this.data&&this.data.length>0){var i=this.data[0];this.layerObj=this.buildPointVector(i)}this.layerObj?e&&t?this.$emit("updateVecLayer",{id:this.compConf.compId,type:"point",layerObj:this.layerObj,show:!0,toggle:!0}):e&&!t?this.$emit("clearVecLayer",{id:this.compConf.compId,show:!1,toggle:!0}):this.notifyBase():this.$emit("clearVecLayer",{id:this.compConf.compId,show:!1,toggle:!0})},_clickByLinkAge:function(e){var t=this;this.$evtBus.on(e,(function(e){t.styleConf.dynamicRef&&t.updateRefKey(e)}))},updateRefKey:function(e){var t=[];e.refData.forEach((function(i){var a=i.cond,n=i.to.split("$")[1],o=e.data[i.from.split("$")[1]];t.push({operationType:a,bindMapperColumn:n,value:o})}));var i={target:e.target,source:e.source,name:e.name,data:t,sourceData:e.data},a={};a[this.compConf.compId]=Object(o["a"])({},"".concat(e.name),i),this.$store.commit("setLinkage",a);var n=e.switchVisible&&e.switchVisible[this.compConf.compId]&&e.switchVisible.hasOwnProperty(this.compConf.compId);e.ctrlShow&&(this.showLayer=n),this.toggleShow(e.ctrlShow,n)}}},h=f,d=i("2877"),p=Object(d["a"])(h,a,n,!1,null,"3f8587a8",null);t["default"]=p.exports}}]);